# 06. 트랜잭션과 잠금

## 1) 트랜잭션 (Transaction)

### 1. 의미 (Meaning)
업무적으로 의미가 있는 최소 작업 단위

<br/>

### 2. 특징 (Features)
* Atomicity

  하나의 트랜잭션은 하나의 원자적 수행이다. 트랜잭션은 완전히 수행하거나 전혀 수행되지 않은 상태로 회복되야 한다.


* Consistency

  트랜잭션을 실행하면 데이터베이스를 하나의 일관된 상태에서 또 다른 일관된 상태로 바뀐다. 일관성은 프로그래머나 무결성 제약 조건을 시행하는 DBMS에서 처리된다.


* Isolation

  하나의 트랜잭션은 완료될 때까지 자신이 갱신한 값을 다른 트랜잭션들이 보게 해서는 안된다. 고립성이 시행되므로 임시 갱신 문제를 해결하며 트랜잭션들의 연쇄 복귀는 불필요하다. 고립성은 갱신에 따른 손실이 없어야 하며 오손 판독 (Dirty Read)이 없고 반복 읽기 (Repeatable)성질을 갖는다.

* Durability

  단 하나의 트랜잭션이 데이터베이스를 변경시키고 그 변경이 완료되면 결과는 이후의 어떠한 고장에도 손실되지 않아야 한다. 지속성을 보장하는 것은 회복 기법의 책임이다.

<br/>

### 3. 필요성(Necessity)
트랜잭션은 데이터의 쓰기 일관성을 보장한다. 여러 트랜잭션이 동시에 몰리더라도 그 결과는 기대값과 일치하도록 보장된다. 트랜잭션은 DBMS의 가장 중요한 기능 중 하나라고 볼 수 있다.

<br/>

### 4. 동시성(Concurrency)
동시성은 서로 다른 작업들을 한 번에 얼마나 많이 처리할 수 있는지를 의미한다.

<br/>

그리고 동시성 제어라는 말은 트랜잭션들의 동시성을 보장하기 위해 연산들을 적절히 관리하는 것을 의미하는데, 트랜잭션들 간 공유되지 않는 데이터를 이용하는 연산들은 동시에 진행하고, 그렇지 않은 연산들은 LOCK과 같은 자원을 먼저 획득한 트랜잭션이 진행할 수 있도록 이뤄진다.


즉, 여러 트랜잭션의 연산들이 공유하고 있는 데이터에 대해선 순차적인 진행이 이뤄지는 걸 전제하고 있는 걸 알 수 있는데, 공유되고 있는 데이터를 대상으로 하는 연산들의 동시성을 높일지 말지에 따라 더 높은 동시성을 보장할 수도 그렇지 않을 수도 있다는 것을 짐작할 수 있다. 특히 트랜잭션은 데이터의 쓰기 일관성이 보장되므로, 이와 같은 연산은 읽기 연산들에게 해당되는 것도 알 수 있다.

<br/>

즉, 읽기 작업은 데이터의 직접적인 조작에 영향을 끼치진 않기 때문에 데이터의 읽기 일관성을 어느 수준으로 두는지에 따라 공유되고 있는 데이터들의 동시성을 더 높일 수도 낮출 수도 있다.

<br/>

읽기 작업의 동시성을 높인다는 말은 곧 한 트랜잭션의 읽기 혹은 쓰기 연산 도중에 다른 트랜잭션의 읽기 연산이 개입할 수 있다는 말을 의미하므로, 일관성을 일부 희생하게 된다. 즉, 데이터의 읽기 일관성과 트랜잭션의 동시성은 서로 상충관계에 있다고 볼 수 있으며, 제공하려는 서비스가 어느 수준의 읽기 일관성을 유지해야 하는지에 따라 트랜잭션의 동시성을 더 높일 수 있는지 아닌지가 결정된다.

<br/>

### 5. Commit & Rollback
Commit: 트랜잭션으로 묶은 연산들을 모두 반영한다.
<div style="display:flex" align="center">
    <img src="images/commit.png" alt="1" width="800"/>
</div>

<br/>

Rollback: 트랜잭션으로 묶은 연산들을 취소하여 가장 최근 Commit 시점으로 되돌린다.
<div style="display:flex" align="center">
    <img src="images/rollback.png" alt="2" width="800"/>
</div>
<hr/>
두 작업 모두 사용자가 직접 명시하면서 처리될 수 있다. Commit은 `autocommit`을 켜두면 시스템에 의해 자동적으로 발생할 수 있으며, Rollback 역시 트랜잭션의 일부 연산에서 오류가 발생했을 때 시스템에 의해 자동으로 발생할 수 있다.
